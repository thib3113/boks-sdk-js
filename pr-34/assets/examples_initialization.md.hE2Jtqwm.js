import{B as M}from"./chunks/BoksController.GGkVg0KA.js";import{_ as B,v as R,q as b,o as n,c as r,j as t,t as l,n as w,e as p,F as I,B as C,N as q,a as V,p as c,ae as S,E as P}from"./chunks/framework.oIOT0jzi.js";const H={class:"boks-demo"},L={class:"card"},$={class:"row"},E=["disabled"],O={key:0,class:"status success"},G={key:1,class:"status"},U={class:"card"},j={key:0,class:"key-display"},F={class:"key-box"},J={key:1,class:"empty-state"},W={class:"actions"},Q={class:"history-section"},X={key:0,class:"history-list"},Y={class:"date"},Z={class:"mini-key"},ee=["onClick"],te={class:"card"},oe=["disabled"],se={key:0,class:"progress-bar"},ie={class:"logs"},ae={class:"log-container"},ne={class:"time"},re={__name:"InitializationDemo",setup(z){const v=typeof window<"u",s=c(""),d=c([]),u=c(!1),f=c(""),k=c([]),h=c(!1),_=c(0),m=c(!1);let y=null;R(()=>{if(v){const o=localStorage.getItem("boks_master_key");o&&(s.value=o,i("Loaded existing Master Key from storage.","success"));const e=localStorage.getItem("boks_key_history");if(e)try{d.value=JSON.parse(e)}catch(a){console.error("Failed to parse history",a)}}}),b(s,o=>{v&&o&&localStorage.setItem("boks_master_key",o)}),b(d,o=>{v&&localStorage.setItem("boks_key_history",JSON.stringify(o))},{deep:!0});function i(o,e="info"){k.value.push({time:new Date().toLocaleTimeString(),msg:o,type:e})}async function T(){var o;if(v)try{i("Requesting Bluetooth device..."),y=new M,i("Connecting..."),await y.connect(),u.value=!0,f.value=(o=y.hardwareInfo)!=null&&o.hardwareVersion?`Boks (${y.hardwareInfo.hardwareVersion})`:"Boks Device",i("Connected successfully!","success")}catch(e){i(`Connection failed: ${e.message}`,"error"),console.error(e)}}function K(){if(s.value&&!confirm("A Master Key already exists! Are you sure you want to generate a new one? The old one will be moved to history but this is risky if you have already initialized a device with it."))return;const o=new Uint8Array(32);window.crypto.getRandomValues(o);const e=Array.from(o).map(a=>a.toString(16).padStart(2,"0")).join("").toUpperCase();s.value=e,d.value.unshift({key:e,date:new Date().toISOString()}),i("New Master Key generated and saved.","success")}async function N(){if(!(!y||!u.value)){if(!s.value){alert("No Master Key available!");return}if(confirm("CRITICAL WARNING: This will initialize the connected Boks device with the displayed Master Key. This operation cannot be undone easily. Ensure you have backed up this key. Continue?")){h.value=!0,_.value=0,i("Starting initialization...","warning");try{await y.initialize(s.value,e=>{_.value=e,i(`Initialization progress: ${e}%`)})?(i("Initialization complete! Device is now paired with this Master Key.","success"),alert("Success! Device Initialized.")):i("Initialization failed (device reported error).","error")}catch(o){i(`Initialization error: ${o.message}`,"error")}finally{h.value=!1}}}}function D(o){navigator.clipboard.writeText(o),i("Copied to clipboard","success")}function A(){confirm("DANGER: This will delete your Master Key from browser storage. If you lose this key, you may lose access to your device. Are you sure?")&&(localStorage.removeItem("boks_master_key"),s.value="",i("Storage cleared.","warning"))}function x(o){confirm("Restore this key from history as the active Master Key?")&&(s.value=o,i("Key restored from history.","success"))}return(o,e)=>(n(),r("div",H,[t("div",L,[e[2]||(e[2]=t("h3",null,"1. Connection",-1)),t("div",$,[t("button",{onClick:T,disabled:u.value,class:"primary-btn"},l(u.value?"Connected":"Scan & Connect"),9,E),u.value?(n(),r("span",O,"Connected to "+l(f.value),1)):(n(),r("span",G,"Not connected"))])]),t("div",U,[e[6]||(e[6]=t("h3",null,"2. Master Key Management",-1)),s.value?(n(),r("div",j,[e[3]||(e[3]=t("p",{class:"label"},"Active Master Key (Saved in Storage)",-1)),t("div",F,[t("code",null,l(s.value),1),t("button",{onClick:e[0]||(e[0]=a=>D(s.value)),class:"icon-btn",title:"Copy"},"ðŸ“‹")]),e[4]||(e[4]=t("p",{class:"warning-text"},"âš ï¸ Do not lose this key. It is required to control your device.",-1))])):(n(),r("div",J,[...e[5]||(e[5]=[t("p",null,"No Master Key found. Generate one to proceed.",-1)])])),t("div",W,[t("button",{onClick:K,class:w(["action-btn",{"secondary-btn":s.value,"primary-btn":!s.value}])},l(s.value?"Regenerate Key (Risky)":"Generate New Master Key"),3),s.value?(n(),r("button",{key:0,onClick:A,class:"danger-btn text-only"}," Clear Storage ")):p("",!0)]),t("div",Q,[t("button",{onClick:e[1]||(e[1]=a=>m.value=!m.value),class:"text-btn"},l(m.value?"Hide History":"Show Key History")+" ("+l(d.value.length)+") ",1),m.value&&d.value.length>0?(n(),r("div",X,[(n(!0),r(I,null,C(d.value,(a,g)=>(n(),r("div",{key:g,class:"history-item"},[t("span",Y,l(new Date(a.date).toLocaleString()),1),t("code",Z,l(a.key.substring(0,8))+"...",1),t("button",{onClick:de=>x(a.key),class:"small-btn"},"Restore",8,ee)]))),128))])):p("",!0)])]),t("div",te,[e[7]||(e[7]=t("h3",null,"3. Device Initialization",-1)),e[8]||(e[8]=t("p",null,"Initialize the connected device with the Active Master Key.",-1)),t("button",{onClick:N,disabled:!u.value||!s.value||h.value,class:"danger-btn big-btn"},l(h.value?"Initializing...":"Initialize Device"),9,oe),h.value?(n(),r("div",se,[t("div",{class:"fill",style:q({width:_.value+"%"})},null,4)])):p("",!0)]),t("div",ie,[e[9]||(e[9]=t("h4",null,"Logs",-1)),t("div",ae,[(n(!0),r(I,null,C(k.value,(a,g)=>(n(),r("div",{key:g,class:w(["log-entry",a.type])},[t("span",ne,"["+l(a.time)+"]",1),V(" "+l(a.msg),1)],2))),128))])])]))}},le=B(re,[["__scopeId","data-v-cf9ba4e9"]]),ve=JSON.parse('{"title":"Initialization Demo","description":"","frontmatter":{},"headers":[],"relativePath":"examples/initialization.md","filePath":"examples/initialization.md"}'),ce={name:"examples/initialization.md"},he=Object.assign(ce,{setup(z){return(v,s)=>(n(),r("div",null,[s[0]||(s[0]=S('<h1 id="initialization-demo" tabindex="-1">Initialization Demo <a class="header-anchor" href="#initialization-demo" aria-label="Permalink to &quot;Initialization Demo&quot;">â€‹</a></h1><p>This interactive tool allows you to safely generate a <strong>Master Key</strong> and initialize a Boks device.</p><div class="danger custom-block"><p class="custom-block-title">CRITICAL WARNING</p><p><strong>This operation is irreversible without the Master Key.</strong> The Master Key generated here is <strong>stored in your browser&#39;s LocalStorage</strong>. If you clear your browser data or lose this key, you will permanently lose administrative access to your device. <strong>Always back up your key immediately after generation.</strong></p></div>',3)),P(le),s[1]||(s[1]=S('<h2 id="how-to-use" tabindex="-1">How to Use <a class="header-anchor" href="#how-to-use" aria-label="Permalink to &quot;How to Use&quot;">â€‹</a></h2><ol><li><strong>Connect</strong>: Click &quot;Scan &amp; Connect&quot; and select your Boks device.</li><li><strong>Generate Key</strong>: If you don&#39;t have a key, generate one. It will be saved automatically.</li><li><strong>Initialize</strong>: Once connected and a key is active, click &quot;Initialize Device&quot;.</li></ol><div class="tip custom-block"><p class="custom-block-title">Note</p><p>This tool uses the Web Bluetooth API and requires a compatible browser (Chrome, Edge, Opera) and Bluetooth hardware.</p></div>',3))]))}});export{ve as __pageData,he as default};
