import{_ as t,o,c as r,a1 as d}from"./chunks/framework.DzgYV-e_.js";const h=JSON.parse('{"title":"Protocole BLE & Workflows","description":"","frontmatter":{},"headers":[],"relativePath":"fr/guide/protocol.md","filePath":"fr/guide/protocol.md"}'),a={name:"fr/guide/protocol.md"};function s(i,e,n,c,l,u){return o(),r("div",null,[...e[0]||(e[0]=[d('<h1 id="protocole-ble-workflows" tabindex="-1">Protocole BLE &amp; Workflows <a class="header-anchor" href="#protocole-ble-workflows" aria-label="Permalink to &quot;Protocole BLE &amp; Workflows&quot;">​</a></h1><p>Le SDK Boks communique avec le matériel via Bluetooth Low Energy (BLE) en utilisant un service GATT propriétaire. La communication est asynchrone et basée sur un modèle requête/réponse piloté par des opcodes.</p><h2 id="services-caracteristiques-gatt" tabindex="-1">Services &amp; Caractéristiques GATT <a class="header-anchor" href="#services-caracteristiques-gatt" aria-label="Permalink to &quot;Services &amp; Caractéristiques GATT&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Service</th><th>UUID</th><th>Usage</th></tr></thead><tbody><tr><td><strong>Service Boks</strong></td><td><code>a7630001-f491-4f21-95ea-846ba586e361</code></td><td>Service de communication principal</td></tr><tr><td><strong>Infos Appareil</strong></td><td><code>0000180a-0000-1000-8000-00805f9b34fb</code></td><td>Versioning et infos matériel</td></tr><tr><td><strong>Service Batterie</strong></td><td><code>0000180f-0000-1000-8000-00805f9b34fb</code></td><td>Niveau de batterie standard</td></tr></tbody></table><h3 id="caracteristiques-service-boks" tabindex="-1">Caractéristiques (Service Boks) <a class="header-anchor" href="#caracteristiques-service-boks" aria-label="Permalink to &quot;Caractéristiques (Service Boks)&quot;">​</a></h3><ul><li><strong>Write</strong> (<code>a7630002-...</code>) : Utilisé pour envoyer des commandes (<strong>Downlink</strong>).</li><li><strong>Notify</strong> (<code>a7630003-...</code>) : Utilisé par l&#39;appareil pour envoyer des mises à jour de statut et des réponses (<strong>Uplink</strong>).</li></ul><hr><h2 id="structure-des-paquets" tabindex="-1">Structure des Paquets <a class="header-anchor" href="#structure-des-paquets" aria-label="Permalink to &quot;Structure des Paquets&quot;">​</a></h2><p>Tous les paquets suivent un format binaire cohérent :</p><p><code>[Opcode (1 octet)] [Longueur (1 octet)] [Charge utile (N octets)] [Checksum (1 octet)]</code></p><ul><li><strong>Opcode</strong> : Identifie le type de commande ou de notification.</li><li><strong>Longueur</strong> : Nombre d&#39;octets dans la charge utile (payload).</li><li><strong>Payload</strong> : Les données réelles (arguments ou résultats).</li><li><strong>Checksum</strong> : Somme de 8 bits de tous les octets précédents (<code>sum &amp; 0xFF</code>).</li></ul><hr><h2 id="workflows-operationnels" tabindex="-1">Workflows Opérationnels <a class="header-anchor" href="#workflows-operationnels" aria-label="Permalink to &quot;Workflows Opérationnels&quot;">​</a></h2><h3 id="_1-gestion-des-codes" tabindex="-1">1. Gestion des Codes <a class="header-anchor" href="#_1-gestion-des-codes" aria-label="Permalink to &quot;1. Gestion des Codes&quot;">​</a></h3><p>L&#39;appareil gère trois types distincts de codes d&#39;accès :</p><ul><li><strong>Codes permanents</strong> : PINs stockés dans 5 emplacements dédiés (0-4).</li><li><strong>Single-Use Codes</strong> : PINs temporaires qui expirent immédiatement après une ouverture réussie.</li><li><strong>Multi-Use Codes</strong> : PINs temporaires réutilisables. <em>Note : La génération de ces codes est désactivée dans les versions de firmware &gt; 4.3.3.</em></li></ul><p><strong>Authentification</strong> : La plupart des opérations sur les codes (Création, Édition, Suppression) nécessitent une <strong>ConfigKey</strong> (8 octets) au début de la payload pour autoriser la modification.</p><h3 id="_2-transfert-d-historique-en-rafale-le-burst" tabindex="-1">2. Transfert d&#39;Historique en Rafale (le &quot;Burst&quot;) <a class="header-anchor" href="#_2-transfert-d-historique-en-rafale-le-burst" aria-label="Permalink to &quot;2. Transfert d&#39;Historique en Rafale (le &quot;Burst&quot;)&quot;">​</a></h3><p>Lorsque l&#39;historique est demandé (<code>0x03 REQUEST_LOGS</code>), l&#39;appareil entre dans un mode de notification rapide :</p><ol><li>Le client envoie <code>0x03</code>.</li><li>L&#39;appareil envoie une séquence de paquets de notification, un pour chaque événement enregistré.</li><li>Chaque payload d&#39;événement commence par un <strong>Âge sur 3 octets</strong> (secondes écoulées depuis l&#39;événement, Big Endian).</li><li>La séquence se termine <strong>toujours</strong> par un paquet <code>0x92 END_HISTORY</code>.</li></ol><h3 id="_3-workflow-des-tags-nfc" tabindex="-1">3. Workflow des Tags NFC <a class="header-anchor" href="#_3-workflow-des-tags-nfc" aria-label="Permalink to &quot;3. Workflow des Tags NFC&quot;">​</a></h3><p>L&#39;enregistrement d&#39;un tag NFC est un processus de &quot;Découverte&quot; en deux étapes :</p><ol><li><strong>Scan</strong> : Envoyer <code>0x17 REGISTER_NFC_TAG_SCAN_START</code>. La LED de l&#39;appareil clignote généralement.</li><li><strong>Détection</strong> : Lorsqu&#39;un tag est présenté, l&#39;appareil émet <code>0xC5 NOTIFY_NFC_TAG_FOUND</code> contenant l&#39;UID brut.</li><li><strong>Enregistrement</strong> : Pour persister le tag, le client doit envoyer <code>0x18 REGISTER_NFC_TAG</code> avec l&#39;UID et la <strong>ConfigKey</strong>.</li></ol><hr><h2 id="registre-des-commandes-opcodes-courants" tabindex="-1">Registre des Commandes (Opcodes courants) <a class="header-anchor" href="#registre-des-commandes-opcodes-courants" aria-label="Permalink to &quot;Registre des Commandes (Opcodes courants)&quot;">​</a></h2><h3 id="controle-statut" tabindex="-1">Contrôle &amp; Statut <a class="header-anchor" href="#controle-statut" aria-label="Permalink to &quot;Contrôle &amp; Statut&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Opcode</th><th>Nom</th><th>Payload</th></tr></thead><tbody><tr><td><code>0x01</code></td><td>OPEN_DOOR</td><td><code>[PIN(6)]</code></td></tr><tr><td><code>0x02</code></td><td>ASK_DOOR_STATUS</td><td>(Vide)</td></tr><tr><td><code>0x06</code></td><td>REBOOT</td><td>(Vide)</td></tr><tr><td><code>0x08</code></td><td>TEST_BATTERY</td><td>(Vide)</td></tr></tbody></table><h3 id="administratif-requiert-configkey" tabindex="-1">Administratif (Requiert ConfigKey) <a class="header-anchor" href="#administratif-requiert-configkey" aria-label="Permalink to &quot;Administratif (Requiert ConfigKey)&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Opcode</th><th>Nom</th><th>Payload</th></tr></thead><tbody><tr><td><code>0x11</code></td><td>CREATE_MASTER_CODE</td><td><code>[Key(8)] [PIN(6)] [Index(1)] (Crée un code permanent)</code></td></tr><tr><td><code>0x12</code></td><td>CREATE_SINGLE_USE</td><td><code>[Key(8)] [PIN(6)]</code></td></tr><tr><td><code>0x0D</code></td><td>DELETE_SINGLE_USE</td><td><code>[Key(8)] [PIN(6)]</code></td></tr><tr><td><code>0x16</code></td><td>SET_CONFIGURATION</td><td><code>[Key(8)] [Type(1)] [Value(1)]</code></td></tr></tbody></table><h3 id="notifications-uplink" tabindex="-1">Notifications (Uplink) <a class="header-anchor" href="#notifications-uplink" aria-label="Permalink to &quot;Notifications (Uplink)&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Opcode</th><th>Nom</th><th>Description</th></tr></thead><tbody><tr><td><code>0x77</code></td><td>SUCCESS</td><td>Commande acquittée.</td></tr><tr><td><code>0x78</code></td><td>ERROR</td><td>Échec de la commande (souvent auth ou format).</td></tr><tr><td><code>0x81</code></td><td>VALID_PIN</td><td>La porte s&#39;ouvre.</td></tr><tr><td><code>0x82</code></td><td>INVALID_PIN</td><td>Accès refusé.</td></tr><tr><td><code>0x84</code></td><td>DOOR_STATUS</td><td><code>0x00</code> (Fermée) / <code>0x01</code> (Ouverte).</td></tr><tr><td><code>0xC3</code></td><td>CODES_COUNT</td><td><code>[Master(2)] [Autres(2)]</code> (Big Endian).</td></tr></tbody></table>',31)])])}const m=t(a,[["render",s]]);export{h as __pageData,m as default};
