var Ts=Object.defineProperty;var Zn=n=>{throw TypeError(n)};var hs=(n,t,e)=>t in n?Ts(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var o=(n,t,e)=>hs(n,typeof t!="symbol"?t+"":t,e),Bn=(n,t,e)=>t.has(n)||Zn("Cannot "+e);var Re=(n,t,e)=>(Bn(n,t,"read from private field"),e?e.call(n):t.get(n)),je=(n,t,e)=>t.has(n)?Zn("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(n):t.set(n,e),Qe=(n,t,e,s)=>(Bn(n,t,"write to private field"),s?s.call(n,e):t.set(n,e),e);import{_ as Os,v as Rs,q as kn,o as g,c as D,j as T,t as y,n as ts,e as qe,F as es,B as ns,N as As,a as Ss,p as F,ae as ss,E as Ns}from"./chunks/framework.zlwu3cxb.js";var h=(n=>(n.WEB_BLUETOOTH_NOT_SUPPORTED="WEB_BLUETOOTH_NOT_SUPPORTED",n.NOT_CONNECTED="NOT_CONNECTED",n.CONNECTION_FAILED="CONNECTION_FAILURE",n.DISCONNECT_FAILED="DISCONNECT_FAILURE",n.WRITE_FAILED="WRITE_FAILURE",n.SUBSCRIBE_FAILED="SUBSCRIBE_FAILURE",n.TIMEOUT="TIMEOUT",n.PARSE_ERROR="PARSE_ERROR",n.NO_TRANSPORT="NO_TRANSPORT",n.UNKNOWN_ERROR="UNKNOWN_ERROR",n.UNSUPPORTED_FEATURE="UNSUPPORTED_FEATURE",n.INVALID_PARAMETER="INVALID_PARAMETER",n.ALREADY_EXISTS="ALREADY_EXISTS",n))(h||{});class O extends Error{constructor(t,e,s){super(e),this.id=t,this.cause=s,this.name="BoksClientError"}}var r=(n=>(n[n.OPEN_DOOR=1]="OPEN_DOOR",n[n.ASK_DOOR_STATUS=2]="ASK_DOOR_STATUS",n[n.REQUEST_LOGS=3]="REQUEST_LOGS",n[n.REBOOT=6]="REBOOT",n[n.GET_LOGS_COUNT=7]="GET_LOGS_COUNT",n[n.TEST_BATTERY=8]="TEST_BATTERY",n[n.MASTER_CODE_EDIT=9]="MASTER_CODE_EDIT",n[n.SINGLE_USE_CODE_TO_MULTI=10]="SINGLE_USE_CODE_TO_MULTI",n[n.MULTI_CODE_TO_SINGLE_USE=11]="MULTI_CODE_TO_SINGLE_USE",n[n.DELETE_MASTER_CODE=12]="DELETE_MASTER_CODE",n[n.DELETE_SINGLE_USE_CODE=13]="DELETE_SINGLE_USE_CODE",n[n.DELETE_MULTI_USE_CODE=14]="DELETE_MULTI_USE_CODE",n[n.REACTIVATE_CODE=15]="REACTIVATE_CODE",n[n.GENERATE_CODES=16]="GENERATE_CODES",n[n.CREATE_MASTER_CODE=17]="CREATE_MASTER_CODE",n[n.CREATE_SINGLE_USE_CODE=18]="CREATE_SINGLE_USE_CODE",n[n.CREATE_MULTI_USE_CODE=19]="CREATE_MULTI_USE_CODE",n[n.COUNT_CODES=20]="COUNT_CODES",n[n.GENERATE_CODES_SUPPORT=21]="GENERATE_CODES_SUPPORT",n[n.SET_CONFIGURATION=22]="SET_CONFIGURATION",n[n.REGISTER_NFC_TAG_SCAN_START=23]="REGISTER_NFC_TAG_SCAN_START",n[n.REGISTER_NFC_TAG=24]="REGISTER_NFC_TAG",n[n.UNREGISTER_NFC_TAG=25]="UNREGISTER_NFC_TAG",n[n.RE_GENERATE_CODES_PART1=32]="RE_GENERATE_CODES_PART1",n[n.RE_GENERATE_CODES_PART2=33]="RE_GENERATE_CODES_PART2",n[n.SCALE_BOND=80]="SCALE_BOND",n[n.SCALE_GET_MAC_ADDRESS_BOKS=82]="SCALE_GET_MAC_ADDRESS_BOKS",n[n.SCALE_FORGET_BONDING=83]="SCALE_FORGET_BONDING",n[n.SCALE_TARE_EMPTY=85]="SCALE_TARE_EMPTY",n[n.SCALE_TARE_LOADED=86]="SCALE_TARE_LOADED",n[n.SCALE_MEASURE_WEIGHT=87]="SCALE_MEASURE_WEIGHT",n[n.SCALE_PREPARE_DFU=96]="SCALE_PREPARE_DFU",n[n.SCALE_GET_RAW_SENSORS=97]="SCALE_GET_RAW_SENSORS",n[n.SCALE_RECONNECT=98]="SCALE_RECONNECT",n[n.CODE_OPERATION_SUCCESS=119]="CODE_OPERATION_SUCCESS",n[n.CODE_OPERATION_ERROR=120]="CODE_OPERATION_ERROR",n[n.NOTIFY_LOGS_COUNT=121]="NOTIFY_LOGS_COUNT",n[n.ERROR_COMMAND_NOT_SUPPORTED=128]="ERROR_COMMAND_NOT_SUPPORTED",n[n.VALID_OPEN_CODE=129]="VALID_OPEN_CODE",n[n.INVALID_OPEN_CODE=130]="INVALID_OPEN_CODE",n[n.NOTIFY_DOOR_STATUS=132]="NOTIFY_DOOR_STATUS",n[n.ANSWER_DOOR_STATUS=133]="ANSWER_DOOR_STATUS",n[n.LOG_CODE_BLE_VALID=134]="LOG_CODE_BLE_VALID",n[n.LOG_CODE_KEY_VALID=135]="LOG_CODE_KEY_VALID",n[n.LOG_CODE_BLE_INVALID=136]="LOG_CODE_BLE_INVALID",n[n.LOG_CODE_KEY_INVALID=137]="LOG_CODE_KEY_INVALID",n[n.LOG_DOOR_CLOSE=144]="LOG_DOOR_CLOSE",n[n.LOG_DOOR_OPEN=145]="LOG_DOOR_OPEN",n[n.LOG_END_HISTORY=146]="LOG_END_HISTORY",n[n.LOG_HISTORY_ERASE=147]="LOG_HISTORY_ERASE",n[n.POWER_OFF=148]="POWER_OFF",n[n.BLOCK_RESET=149]="BLOCK_RESET",n[n.POWER_ON=150]="POWER_ON",n[n.BLE_REBOOT=151]="BLE_REBOOT",n[n.LOG_EVENT_SCALE_MEASURE=152]="LOG_EVENT_SCALE_MEASURE",n[n.LOG_EVENT_KEY_OPENING=153]="LOG_EVENT_KEY_OPENING",n[n.LOG_EVENT_ERROR=160]="LOG_EVENT_ERROR",n[n.LOG_EVENT_NFC_OPENING=161]="LOG_EVENT_NFC_OPENING",n[n.LOG_EVENT_NFC_REGISTERING=162]="LOG_EVENT_NFC_REGISTERING",n[n.NOTIFY_CODES_COUNT=195]="NOTIFY_CODES_COUNT",n[n.NOTIFY_SET_CONFIGURATION_SUCCESS=196]="NOTIFY_SET_CONFIGURATION_SUCCESS",n[n.NOTIFY_NFC_TAG_FOUND=197]="NOTIFY_NFC_TAG_FOUND",n[n.ERROR_NFC_TAG_ALREADY_EXISTS_SCAN=198]="ERROR_NFC_TAG_ALREADY_EXISTS_SCAN",n[n.ERROR_NFC_SCAN_TIMEOUT=199]="ERROR_NFC_SCAN_TIMEOUT",n[n.NOTIFY_NFC_TAG_REGISTERED=200]="NOTIFY_NFC_TAG_REGISTERED",n[n.NOTIFY_NFC_TAG_REGISTERED_ERROR_ALREADY_EXISTS=201]="NOTIFY_NFC_TAG_REGISTERED_ERROR_ALREADY_EXISTS",n[n.NOTIFY_NFC_TAG_UNREGISTERED=202]="NOTIFY_NFC_TAG_UNREGISTERED",n[n.NOTIFY_CODE_GENERATION_SUCCESS=192]="NOTIFY_CODE_GENERATION_SUCCESS",n[n.NOTIFY_CODE_GENERATION_ERROR=193]="NOTIFY_CODE_GENERATION_ERROR",n[n.NOTIFY_CODE_GENERATION_PROGRESS=194]="NOTIFY_CODE_GENERATION_PROGRESS",n[n.NOTIFY_SCALE_BONDING_SUCCESS=176]="NOTIFY_SCALE_BONDING_SUCCESS",n[n.NOTIFY_SCALE_BONDING_ERROR=177]="NOTIFY_SCALE_BONDING_ERROR",n[n.NOTIFY_MAC_ADDRESS_BOKS_SCALE=178]="NOTIFY_MAC_ADDRESS_BOKS_SCALE",n[n.NOTIFY_SCALE_BONDING_FORGET_SUCCESS=179]="NOTIFY_SCALE_BONDING_FORGET_SUCCESS",n[n.NOTIFY_SCALE_BONDING_PROGRESS=180]="NOTIFY_SCALE_BONDING_PROGRESS",n[n.NOTIFY_SCALE_TARE_EMPTY_OK=181]="NOTIFY_SCALE_TARE_EMPTY_OK",n[n.NOTIFY_SCALE_TARE_LOADED_OK=182]="NOTIFY_SCALE_TARE_LOADED_OK",n[n.NOTIFY_SCALE_MEASURE_WEIGHT=183]="NOTIFY_SCALE_MEASURE_WEIGHT",n[n.NOTIFY_SCALE_DISCONNECTED=184]="NOTIFY_SCALE_DISCONNECTED",n[n.NOTIFY_SCALE_RAW_SENSORS=185]="NOTIFY_SCALE_RAW_SENSORS",n[n.NOTIFY_SCALE_FAULTY=186]="NOTIFY_SCALE_FAULTY",n[n.ERROR_CRC=224]="ERROR_CRC",n[n.ERROR_UNAUTHORIZED=225]="ERROR_UNAUTHORIZED",n[n.ERROR_BAD_REQUEST=226]="ERROR_BAD_REQUEST",n))(r||{});const L={DFU_SERVICE:"0000fe59-0000-1000-8000-00805f9b34fb",DFU_CONTROL_POINT:"8ec90001-f315-4f60-9fb8-838830daea50",SERVICE:"a7630001-f491-4f21-95ea-846ba586e361",WRITE:"a7630002-f491-4f21-95ea-846ba586e361",NOTIFY:"a7630003-f491-4f21-95ea-846ba586e361",CUSTOM_BATTERY:"00000004-0000-1000-8000-00805f9b34fb",BATTERY_SERVICE:"0000180f-0000-1000-8000-00805f9b34fb",BATTERY_LEVEL:"00002a19-0000-1000-8000-00805f9b34fb",DEVICE_INFO_SERVICE:"0000180a-0000-1000-8000-00805f9b34fb",FIRMWARE_REVISION:"00002a26-0000-1000-8000-00805f9b34fb",SOFTWARE_REVISION:"00002a28-0000-1000-8000-00805f9b34fb",HARDWARE_REVISION:"00002a27-0000-1000-8000-00805f9b34fb"},ds=255,x=255;var is=(n=>(n[n.Single=0]="Single",n[n.Multi=1]="Multi",n[n.Master=2]="Master",n))(is||{});class Cs{constructor(t){o(this,"device",null);o(this,"server",null);o(this,"writeChar",null);o(this,"notifyChar",null);t&&(this.device=t)}async connect(){var t;if(!this.device&&(typeof navigator>"u"||!navigator.bluetooth))throw new O(h.WEB_BLUETOOTH_NOT_SUPPORTED,"Web Bluetooth is not supported in this environment.");try{if(this.device||(this.device=await navigator.bluetooth.requestDevice({filters:[{services:[L.SERVICE]}],optionalServices:[L.SERVICE,L.BATTERY_SERVICE,L.DEVICE_INFO_SERVICE]})),!((t=this.device)!=null&&t.gatt))throw new O(h.CONNECTION_FAILED,"GATT Server not available.");this.server=await this.device.gatt.connect();const e=await this.server.getPrimaryService(L.SERVICE);this.writeChar=await e.getCharacteristic(L.WRITE),this.notifyChar=await e.getCharacteristic(L.NOTIFY)}catch(e){throw e instanceof O?e:new O(h.CONNECTION_FAILED,"Failed to connect to Boks device",e)}}async disconnect(){var t;try{(t=this.server)!=null&&t.connected&&this.server.disconnect()}catch(e){throw new O(h.DISCONNECT_FAILED,"Failed to disconnect",e)}}async write(t){if(!this.writeChar)throw new O(h.NOT_CONNECTED,"Not connected (Write characteristic missing).");try{await this.writeChar.writeValueWithResponse(t)}catch(e){throw new O(h.WRITE_FAILED,"Failed to write to Boks device",e)}}async read(t){var e;if(!((e=this.server)!=null&&e.connected))throw new O(h.NOT_CONNECTED,"Not connected to GATT server.");try{const s=await this.server.getPrimaryServices();for(const i of s)try{const a=await(await i.getCharacteristic(t)).readValue();return new Uint8Array(a.buffer)}catch{}throw new Error(`Characteristic ${t} not found in any visible service.`)}catch(s){throw new O(h.PARSE_ERROR,`Failed to read characteristic ${t}`,s)}}async subscribe(t){if(!this.notifyChar)throw new O(h.NOT_CONNECTED,"Not connected (Notify characteristic missing).");try{await this.notifyChar.startNotifications(),this.notifyChar.addEventListener("characteristicvaluechanged",e=>{const i=e.target.value;i&&t(new Uint8Array(i.buffer))})}catch(e){throw new O(h.SUBSCRIBE_FAILED,"Failed to subscribe to notifications",e)}}}const ws=Array.from({length:256},(n,t)=>t.toString(16).padStart(2,"0").toUpperCase()),_e=new Uint8Array(256);_e.fill(255);for(let n=0;n<10;n++)_e[48+n]=n;for(let n=0;n<6;n++)_e[65+n]=10+n;const G=n=>{const t=n.replace(/\s/g,"");if(t.length%2!==0)throw new Error("Invalid hex string");const e=t.length,s=new Uint8Array(e/2);for(let i=0;i<e;i+=2){const c=_e[t.charCodeAt(i)],a=_e[t.charCodeAt(i+1)];if(c===255||a===255)throw new Error("Invalid hex character");s[i/2]=c<<4|a}return s},p=n=>{const t=n.length,e=new Array(t);for(let s=0;s<t;s++)e[s]=ws[n[s]];return e.join("")},R=n=>new TextEncoder().encode(n),u=n=>new TextDecoder().decode(n).replace(/\0/g,""),os=n=>{let t=0;for(let e=0;e<n.length;e++)t+=n[e];return t&ds};class d{constructor(){o(this,"rawPayload",new Uint8Array(0))}static fromPayload(t){throw new Error("fromPayload not implemented")}encode(){const t=this.toPayload(),e=new Uint8Array(t.length+3);return e[0]=this.opcode,e[1]=t.length,e.set(t,2),e[e.length-1]=os(e.subarray(0,e.length-1)),e}}var ue=(n=>(n.INVALID_PAYLOAD_LENGTH="INVALID_PAYLOAD_LENGTH",n.INVALID_CONFIG_KEY="INVALID_CONFIG_KEY",n.INVALID_VALUE="INVALID_VALUE",n.MALFORMED_DATA="MALFORMED_DATA",n))(ue||{});class Ae extends Error{constructor(t,e,s){super(e),this.id=t,this.context=s,this.name="BoksProtocolError"}}function m(n){if(!/^[0-9A-B]{6}$/.test(n))throw new Ae(ue.INVALID_VALUE,"PIN must be exactly 6 characters using only 0-9, A, and B",{received:n})}const Y=class Y extends d{constructor(t){super(),this.pin=t,m(t)}get opcode(){return Y.opcode}static fromPayload(t){return new Y(u(t))}toPayload(){return R(this.pin)}};o(Y,"opcode",r.OPEN_DOOR);let Se=Y;const b=class b extends d{get opcode(){return b.opcode}static fromPayload(t){return new b}toPayload(){return new Uint8Array(0)}};o(b,"opcode",r.ASK_DOOR_STATUS);let Ne=b;const P=class P extends d{get opcode(){return P.opcode}static fromPayload(t){return new P}toPayload(){return new Uint8Array(0)}};o(P,"opcode",r.REQUEST_LOGS);let de=P;const K=class K extends d{get opcode(){return K.opcode}static fromPayload(t){return new K}toPayload(){return new Uint8Array(0)}};o(K,"opcode",r.REBOOT);let Ce=K;const V=class V extends d{get opcode(){return V.opcode}static fromPayload(t){return new V}toPayload(){return new Uint8Array(0)}};o(V,"opcode",r.GET_LOGS_COUNT);let we=V;const M=class M extends d{get opcode(){return M.opcode}static fromPayload(t){return new M}toPayload(){return new Uint8Array(0)}};o(M,"opcode",r.TEST_BATTERY);let Ie=M;class w extends d{constructor(t){if(super(),this.configKey=t,!/^[0-9A-F]{8}$/.test(t))throw new Ae(ue.INVALID_CONFIG_KEY,"Config Key must be exactly 8 uppercase hexadecimal characters")}}const W=class W extends w{constructor(t,e,s){super(t),this.index=e,this.newPin=s,m(s)}get opcode(){return W.opcode}static fromPayload(t){const e=u(t.slice(0,8));let s=0;t.length>8&&(s=t[8]);const i=u(t.slice(9,15));return new W(e,s,i)}toPayload(){const t=new Uint8Array(15);t.set(R(this.configKey),0),t[8]=this.index;const e=R(this.newPin),s=new Uint8Array(6);return s.set(e.slice(0,6)),t.set(s,9),t}};o(W,"opcode",r.MASTER_CODE_EDIT);let fe=W;const z=class z extends w{constructor(t,e){super(t),this.pin=e,m(e)}get opcode(){return z.opcode}static fromPayload(t){const e=u(t.slice(0,8)),s=u(t.slice(8,14));return new z(e,s)}toPayload(){const t=new Uint8Array(14);t.set(R(this.configKey),0);const e=R(this.pin),s=new Uint8Array(6);return s.set(e.slice(0,6)),t.set(s,8),t}};o(z,"opcode",r.SINGLE_USE_CODE_TO_MULTI);let ge=z;const $=class $ extends w{constructor(t,e){super(t),this.pin=e,m(e)}get opcode(){return $.opcode}static fromPayload(t){const e=u(t.slice(0,8)),s=u(t.slice(8,14));return new $(e,s)}toPayload(){const t=new Uint8Array(14);t.set(R(this.configKey),0);const e=R(this.pin),s=new Uint8Array(6);return s.set(e.slice(0,6)),t.set(s,8),t}};o($,"opcode",r.MULTI_CODE_TO_SINGLE_USE);let De=$;const H=class H extends w{constructor(t,e){super(t),this.index=e}get opcode(){return H.opcode}static fromPayload(t){const e=u(t.slice(0,8));let s=0;return t.length>8&&(s=t[8]),new H(e,s)}toPayload(){const t=new Uint8Array(9);return t.set(R(this.configKey),0),t[8]=this.index,t}};o(H,"opcode",r.DELETE_MASTER_CODE);let ye=H;const X=class X extends w{constructor(t,e){super(t),this.pin=e,m(e)}get opcode(){return X.opcode}static fromPayload(t){const e=u(t.slice(0,8)),s=u(t.slice(8,14));return new X(e,s)}toPayload(){const t=new Uint8Array(14);t.set(R(this.configKey),0);const e=R(this.pin),s=new Uint8Array(6);return s.set(e.slice(0,6)),t.set(s,8),t}};o(X,"opcode",r.DELETE_SINGLE_USE_CODE);let Le=X;const j=class j extends w{constructor(t,e){super(t),this.pin=e,m(e)}get opcode(){return j.opcode}static fromPayload(t){const e=u(t.slice(0,8)),s=u(t.slice(8,14));return new j(e,s)}toPayload(){const t=new Uint8Array(14);t.set(R(this.configKey),0);const e=R(this.pin),s=new Uint8Array(6);return s.set(e.slice(0,6)),t.set(s,8),t}};o(j,"opcode",r.DELETE_MULTI_USE_CODE);let me=j;const Q=class Q extends w{constructor(t,e){super(t),this.pin=e,m(e)}get opcode(){return Q.opcode}static fromPayload(t){const e=u(t.slice(0,8)),s=u(t.slice(8,14));return new Q(e,s)}toPayload(){const t=new Uint8Array(14);t.set(R(this.configKey),0);const e=R(this.pin),s=new Uint8Array(6);return s.set(e.slice(0,6)),t.set(s,8),t}};o(Q,"opcode",r.REACTIVATE_CODE);let Ue=Q;const q=class q extends d{constructor(t){super(),this.seed=t}get opcode(){return q.opcode}static fromPayload(t){return new q(t)}toPayload(){const t=typeof this.seed=="string"?G(this.seed):this.seed;if(t.length!==32)throw new Error("Seed must be exactly 32 bytes");return t}};o(q,"opcode",r.GENERATE_CODES);let Fe=q;const J=class J extends w{constructor(t,e,s){super(t),this.index=e,this.pin=s,m(s)}get opcode(){return J.opcode}static fromPayload(t){const e=u(t.slice(0,8)),s=u(t.slice(8,14));let i=0;return t.length>14&&(i=t[14]),new J(e,i,s)}toPayload(){const t=new Uint8Array(15);t.set(R(this.configKey),0);const e=R(this.pin),s=new Uint8Array(6);return s.set(e.slice(0,6)),t.set(s,8),t[14]=this.index,t}};o(J,"opcode",r.CREATE_MASTER_CODE);let Ge=J;const Z=class Z extends w{constructor(t,e){super(t),this.pin=e,m(e)}get opcode(){return Z.opcode}static fromPayload(t){const e=u(t.slice(0,8)),s=u(t.slice(8,14));return new Z(e,s)}toPayload(){const t=new Uint8Array(14);t.set(R(this.configKey),0);const e=R(this.pin),s=new Uint8Array(6);return s.set(e.slice(0,6)),t.set(s,8),t}};o(Z,"opcode",r.CREATE_SINGLE_USE_CODE);let ve=Z;const B=class B extends w{constructor(t,e){super(t),this.pin=e,m(e)}get opcode(){return B.opcode}static fromPayload(t){const e=u(t.slice(0,8)),s=u(t.slice(8,14));return new B(e,s)}toPayload(){const t=new Uint8Array(14);t.set(R(this.configKey),0);const e=R(this.pin),s=new Uint8Array(6);return s.set(e.slice(0,6)),t.set(s,8),t}};o(B,"opcode",r.CREATE_MULTI_USE_CODE);let pe=B;const k=class k extends d{get opcode(){return k.opcode}static fromPayload(t){return new k}toPayload(){return new Uint8Array(0)}};o(k,"opcode",r.COUNT_CODES);let xe=k;const tt=class tt extends d{constructor(t){super(),this.seed=t}get opcode(){return tt.opcode}static fromPayload(t){return new tt(t)}toPayload(){const t=typeof this.seed=="string"?G(this.seed):this.seed;if(t.length!==32)throw new Error("Seed must be exactly 32 bytes");return t}};o(tt,"opcode",r.GENERATE_CODES_SUPPORT);let Je=tt;const et=class et extends w{constructor(t,e,s){super(t),this.configType=e,this.value=s}get opcode(){return et.opcode}static fromPayload(t){if(t.length!==10)throw new Ae(ue.INVALID_PAYLOAD_LENGTH,"SetConfigurationPacket must be exactly 10 bytes long",{received:t.length,expected:10});const e=u(t.subarray(0,8)),s=t[8],i=t[9];if(i!==0&&i!==1)throw new Ae(ue.INVALID_VALUE,"SetConfigurationPacket value must be 0x00 or 0x01",{received:i});return new et(e,s,i===1)}toPayload(){const t=new Uint8Array(10);return t.set(R(this.configKey),0),t[8]=this.configType,t[9]=this.value?1:0,t}};o(et,"opcode",r.SET_CONFIGURATION);let Ye=et;const nt=class nt extends w{get opcode(){return nt.opcode}constructor(t){super(t)}static fromPayload(t){const e=u(t.slice(0,8));return new nt(e)}toPayload(){return R(this.configKey)}};o(nt,"opcode",r.REGISTER_NFC_TAG_SCAN_START);let be=nt;const st=class st extends w{constructor(t,e){super(t),this.uid=e}get opcode(){return st.opcode}static fromPayload(t){var i;const e=u(t.slice(0,8));let s="";if(t.length>8){const c=t[8];t.length>=9+c&&(s=((i=p(t.slice(9,9+c)).match(/.{1,2}/g))==null?void 0:i.join(":"))||"")}return new st(e,s)}toPayload(){const t=G(this.uid.replace(/:/g,"")),e=new Uint8Array(9+t.length);return e.set(R(this.configKey),0),e[8]=t.length,e.set(t,9),e}};o(st,"opcode",r.REGISTER_NFC_TAG);let Pe=st;const rt=class rt extends w{constructor(t,e){super(t),this.uid=e}get opcode(){return rt.opcode}static fromPayload(t){var i;const e=u(t.slice(0,8));let s="";if(t.length>8){const c=t[8];t.length>=9+c&&(s=((i=p(t.slice(9,9+c)).match(/.{1,2}/g))==null?void 0:i.join(":"))||"")}return new rt(e,s)}toPayload(){const t=G(this.uid.replace(/:/g,"")),e=new Uint8Array(9+t.length);return e.set(R(this.configKey),0),e[8]=t.length,e.set(t,9),e}};o(rt,"opcode",r.UNREGISTER_NFC_TAG);let Ke=rt;const it=class it extends w{constructor(t,e){if(super(t),this.part=e,e.length!==16)throw new Error("Token part must be exactly 16 bytes")}get opcode(){return it.opcode}static fromPayload(t){const e=u(t.slice(0,8)),s=t.slice(8,24);return new it(e,s)}toPayload(){const t=new Uint8Array(24);return t.set(R(this.configKey),0),t.set(this.part,8),t}};o(it,"opcode",r.RE_GENERATE_CODES_PART1);let Te=it;const ot=class ot extends w{constructor(t,e){if(super(t),this.part=e,e.length!==16)throw new Error("Token part must be exactly 16 bytes")}get opcode(){return ot.opcode}static fromPayload(t){const e=u(t.slice(0,8)),s=t.slice(8,24);return new ot(e,s)}toPayload(){const t=new Uint8Array(24);return t.set(R(this.configKey),0),t.set(this.part,8),t}};o(ot,"opcode",r.RE_GENERATE_CODES_PART2);let he=ot;const ct=class ct extends d{constructor(t=new Uint8Array(0)){super(),this.data=t}get opcode(){return ct.opcode}static fromPayload(t){return new ct(t)}toPayload(){return this.data}};o(ct,"opcode",r.SCALE_BOND);let Ve=ct;const at=class at extends d{get opcode(){return at.opcode}static fromPayload(t){return new at}toPayload(){return new Uint8Array(0)}};o(at,"opcode",r.SCALE_GET_MAC_ADDRESS_BOKS);let Ze=at;const Et=class Et extends d{get opcode(){return Et.opcode}static fromPayload(t){return new Et}toPayload(){return new Uint8Array(0)}};o(Et,"opcode",r.SCALE_FORGET_BONDING);let Me=Et;const lt=class lt extends d{get opcode(){return lt.opcode}static fromPayload(t){return new lt}toPayload(){return new Uint8Array(0)}};o(lt,"opcode",r.SCALE_TARE_EMPTY);let We=lt;const _t=class _t extends d{constructor(t=new Uint8Array(0)){super(),this.data=t}get opcode(){return _t.opcode}static fromPayload(t){return new _t(t)}toPayload(){return this.data}};o(_t,"opcode",r.SCALE_TARE_LOADED);let ze=_t;const ut=class ut extends d{get opcode(){return ut.opcode}static fromPayload(t){return new ut}toPayload(){return new Uint8Array(0)}};o(ut,"opcode",r.SCALE_MEASURE_WEIGHT);let $e=ut;const Tt=class Tt extends d{get opcode(){return Tt.opcode}static fromPayload(t){return new Tt}toPayload(){return new Uint8Array(0)}};o(Tt,"opcode",r.SCALE_PREPARE_DFU);let Be=Tt;const ht=class ht extends d{get opcode(){return ht.opcode}static fromPayload(t){return new ht}toPayload(){return new Uint8Array(0)}};o(ht,"opcode",r.SCALE_GET_RAW_SENSORS);let He=ht;const Ot=class Ot extends d{get opcode(){return Ot.opcode}static fromPayload(t){return new Ot}toPayload(){return new Uint8Array(0)}};o(Ot,"opcode",r.SCALE_RECONNECT);let ke=Ot;class l extends d{constructor(t,e){super(),this._opcode=t,this._rawPayload=e,e&&(this.rawPayload=e)}get opcode(){return this._opcode}toPayload(){return this.rawPayload}}const Rt=class Rt extends l{constructor(t){super(Rt.opcode,t)}static fromPayload(t){return new Rt(t)}};o(Rt,"opcode",r.NOTIFY_SCALE_BONDING_SUCCESS);let tn=Rt;const At=class At extends l{constructor(t=0,e){super(At.opcode,e),this.errorCode=t}static fromPayload(t){let e=0;return t.length>0&&(e=t[0]),new At(e,t)}};o(At,"opcode",r.NOTIFY_SCALE_BONDING_ERROR);let en=At;const St=class St extends l{constructor(t="",e){super(St.opcode,e),this.macAddress=t}static fromPayload(t){var s;const e=((s=p(t).match(/.{1,2}/g))==null?void 0:s.join(":"))||"";return new St(e,t)}};o(St,"opcode",r.NOTIFY_MAC_ADDRESS_BOKS_SCALE);let nn=St;const Nt=class Nt extends l{constructor(t){super(Nt.opcode,t)}static fromPayload(t){return new Nt(t)}};o(Nt,"opcode",r.NOTIFY_SCALE_BONDING_FORGET_SUCCESS);let sn=Nt;const dt=class dt extends l{constructor(t=0,e){super(dt.opcode,e),this.progress=t}static fromPayload(t){let e=0;return t.length>0&&(e=t[0]),new dt(e,t)}};o(dt,"opcode",r.NOTIFY_SCALE_BONDING_PROGRESS);let rn=dt;const Ct=class Ct extends l{constructor(t){super(Ct.opcode,t)}static fromPayload(t){return new Ct(t)}};o(Ct,"opcode",r.NOTIFY_SCALE_TARE_EMPTY_OK);let on=Ct;const wt=class wt extends l{constructor(t){super(wt.opcode,t)}static fromPayload(t){return new wt(t)}};o(wt,"opcode",r.NOTIFY_SCALE_TARE_LOADED_OK);let cn=wt;const It=class It extends l{constructor(t=0,e){super(It.opcode,e),this.weight=t}static fromPayload(t){let e=0;if(t.length>=4){const s=t[0]!==0?-1:1,i=t[1]<<16|t[2]<<8|t[3];e=s*i}return new It(e,t)}};o(It,"opcode",r.NOTIFY_SCALE_MEASURE_WEIGHT);let an=It;const ft=class ft extends l{constructor(t){super(ft.opcode,t)}static fromPayload(t){return new ft(t)}};o(ft,"opcode",r.NOTIFY_SCALE_DISCONNECTED);let En=ft;const gt=class gt extends l{constructor(t=new Uint8Array(0),e){super(gt.opcode,e),this.data=t}static fromPayload(t){return new gt(t,t)}};o(gt,"opcode",r.NOTIFY_SCALE_RAW_SENSORS);let ln=gt;const Dt=class Dt extends l{constructor(t=new Uint8Array(0),e){super(Dt.opcode,e),this.data=t}static fromPayload(t){return new Dt(t,t)}};o(Dt,"opcode",r.NOTIFY_SCALE_FAULTY);let _n=Dt;const yt=class yt extends l{constructor(t){super(yt.opcode,t)}static fromPayload(t){return new yt(t)}};o(yt,"opcode",r.CODE_OPERATION_SUCCESS);let un=yt;const Lt=class Lt extends l{constructor(t=0,e){super(Lt.opcode,e),this.errorCode=t}static fromPayload(t){let e=0;return t.length>0&&(e=t[0]),new Lt(e,t)}};o(Lt,"opcode",r.CODE_OPERATION_ERROR);let Tn=Lt;const mt=class mt extends l{constructor(t=0,e){super(mt.opcode,e),this.count=t}static fromPayload(t){let e=0;return t.length>=2&&(e=new DataView(t.buffer,t.byteOffset,t.byteLength).getUint16(0,!1)),new mt(e,t)}};o(mt,"opcode",r.NOTIFY_LOGS_COUNT);let hn=mt;const Ut=class Ut extends l{constructor(t){super(Ut.opcode,t)}static fromPayload(t){return new Ut(t)}};o(Ut,"opcode",r.VALID_OPEN_CODE);let On=Ut;const Ft=class Ft extends l{constructor(t){super(Ft.opcode,t)}static fromPayload(t){return new Ft(t)}};o(Ft,"opcode",r.INVALID_OPEN_CODE);let Rn=Ft;const Gt=class Gt extends l{constructor(t=!1,e){super(Gt.opcode,e),this.isOpen=t}static fromPayload(t){let e=!1;if(t.length>=2){const s=t[0];e=t[1]===1&&s===0}return new Gt(e,t)}};o(Gt,"opcode",r.NOTIFY_DOOR_STATUS);let An=Gt;const vt=class vt extends l{constructor(t=!1,e){super(vt.opcode,e),this.isOpen=t}static fromPayload(t){let e=!1;return t.length>=2&&(e=t[1]===1&&t[0]===0),new vt(e,t)}};o(vt,"opcode",r.ANSWER_DOOR_STATUS);let Sn=vt;const pt=class pt extends l{constructor(t=0,e=0,s){super(pt.opcode,s),this.masterCount=t,this.otherCount=e}static fromPayload(t){let e=0,s=0;if(t.length>=4){const i=new DataView(t.buffer,t.byteOffset,t.byteLength);e=i.getUint16(0,!1),s=i.getUint16(2,!1)}return new pt(e,s,t)}};o(pt,"opcode",r.NOTIFY_CODES_COUNT);let Nn=pt;const xt=class xt extends l{constructor(e="",s){super(xt.opcode,s);o(this,"status","found");this.uid=e}static fromPayload(e){const s=p(e);return new xt(s,e)}};o(xt,"opcode",r.NOTIFY_NFC_TAG_FOUND);let dn=xt;const Yt=class Yt extends l{constructor(e){super(Yt.opcode,e);o(this,"status","already_exists")}static fromPayload(e){return new Yt(e)}};o(Yt,"opcode",r.ERROR_NFC_TAG_ALREADY_EXISTS_SCAN);let Cn=Yt;const bt=class bt extends l{constructor(e){super(bt.opcode,e);o(this,"status","timeout")}static fromPayload(e){return new bt(e)}};o(bt,"opcode",r.ERROR_NFC_SCAN_TIMEOUT);let wn=bt;const Pt=class Pt extends l{constructor(t){super(Pt.opcode,t)}static fromPayload(t){return new Pt(t)}};o(Pt,"opcode",r.NOTIFY_NFC_TAG_REGISTERED);let In=Pt;const Kt=class Kt extends l{constructor(t){super(Kt.opcode,t)}static fromPayload(t){return new Kt(t)}};o(Kt,"opcode",r.NOTIFY_NFC_TAG_REGISTERED_ERROR_ALREADY_EXISTS);let fn=Kt;const Vt=class Vt extends l{constructor(t){super(Vt.opcode,t)}static fromPayload(t){return new Vt(t)}};o(Vt,"opcode",r.NOTIFY_NFC_TAG_UNREGISTERED);let gn=Vt;const Mt=class Mt extends l{constructor(t){super(Mt.opcode,t)}static fromPayload(t){return new Mt(t)}};o(Mt,"opcode",r.LOG_END_HISTORY);let Dn=Mt;const Wt=class Wt extends l{constructor(t){super(Wt.opcode,t)}static fromPayload(t){return new Wt(t)}};o(Wt,"opcode",r.NOTIFY_CODE_GENERATION_SUCCESS);let yn=Wt;const zt=class zt extends l{constructor(t){super(zt.opcode,t)}static fromPayload(t){return new zt(t)}};o(zt,"opcode",r.NOTIFY_CODE_GENERATION_ERROR);let Ln=zt;const $t=class $t extends l{constructor(t=0,e){super($t.opcode,e),this.progress=t}static fromPayload(t){let e=0;return t.length>0&&(e=t[0]),new $t(e,t)}};o($t,"opcode",r.NOTIFY_CODE_GENERATION_PROGRESS);let mn=$t;const Ht=class Ht extends l{constructor(t){super(Ht.opcode,t)}static fromPayload(t){return new Ht(t)}};o(Ht,"opcode",r.NOTIFY_SET_CONFIGURATION_SUCCESS);let Un=Ht;const Xt=class Xt extends l{constructor(t){super(Xt.opcode,t)}static fromPayload(t){return new Xt(t)}};o(Xt,"opcode",r.ERROR_CRC);let Fn=Xt;const jt=class jt extends l{constructor(t){super(jt.opcode,t)}static fromPayload(t){return new jt(t)}};o(jt,"opcode",r.ERROR_UNAUTHORIZED);let Gn=jt;const Qt=class Qt extends l{constructor(t){super(Qt.opcode,t)}static fromPayload(t){return new Qt(t)}};o(Qt,"opcode",r.ERROR_BAD_REQUEST);let vn=Qt;class C extends l{constructor(e,s=0,i){super(e,i);o(this,"age",0);o(this,"date");this.age=s,this.date=new Date(Date.now()-s*1e3)}}const qt=class qt extends C{constructor(t=0,e="",s="",i){super(qt.opcode,t,i),this.code=e,this.connectedMac=s}static fromPayload(t){let e=0,s="",i="";t.length>=3&&(e=t[0]<<16|t[1]<<8|t[2]);const c=3;if(t.length>=c+6&&(s=u(t.slice(c,c+6))),t.length>=17){const a=t.slice(11,17);i=Array.from(a).reverse().map(_=>_.toString(16).padStart(2,"0").toUpperCase()).join(":")}return new qt(e,s,i,t)}};o(qt,"opcode",r.LOG_CODE_BLE_VALID);let pn=qt;const Jt=class Jt extends C{constructor(t=0,e="",s="",i){super(Jt.opcode,t,i),this.code=e,this.connectedMac=s}static fromPayload(t){let e=0,s="",i="";t.length>=3&&(e=t[0]<<16|t[1]<<8|t[2]);const c=3;if(t.length>=c+6&&(s=u(t.slice(c,c+6))),t.length>=17){const a=t.slice(11,17);i=Array.from(a).reverse().map(_=>_.toString(16).padStart(2,"0").toUpperCase()).join(":")}return new Jt(e,s,i,t)}};o(Jt,"opcode",r.LOG_CODE_BLE_INVALID);let xn=Jt;const Zt=class Zt extends C{constructor(t=0,e="",s){super(Zt.opcode,t,s),this.code=e}static fromPayload(t){let e=0,s="";t.length>=3&&(e=t[0]<<16|t[1]<<8|t[2]);const i=3;return t.length>=i+6&&(s=u(t.slice(i,i+6))),new Zt(e,s,t)}};o(Zt,"opcode",r.LOG_CODE_KEY_VALID);let Yn=Zt;const Bt=class Bt extends C{constructor(t=0,e="",s){super(Bt.opcode,t,s),this.code=e}static fromPayload(t){let e=0,s="";t.length>=3&&(e=t[0]<<16|t[1]<<8|t[2]);const i=3;return t.length>=i+6&&(s=u(t.slice(i,i+6))),new Bt(e,s,t)}};o(Bt,"opcode",r.LOG_CODE_KEY_INVALID);let bn=Bt;const kt=class kt extends C{constructor(e=0,s){super(kt.opcode,e,s);o(this,"status","open")}static fromPayload(e){let s=0;return e.length>=3&&(s=e[0]<<16|e[1]<<8|e[2]),new kt(s,e)}};o(kt,"opcode",r.LOG_DOOR_OPEN);let Pn=kt;const te=class te extends C{constructor(e=0,s){super(te.opcode,e,s);o(this,"status","closed")}static fromPayload(e){let s=0;return e.length>=3&&(s=e[0]<<16|e[1]<<8|e[2]),new te(s,e)}};o(te,"opcode",r.LOG_DOOR_CLOSE);let Kn=te;const ee=class ee extends C{constructor(t=0,e){super(ee.opcode,t,e)}static fromPayload(t){let e=0;return t.length>=3&&(e=t[0]<<16|t[1]<<8|t[2]),new ee(e,t)}};o(ee,"opcode",r.LOG_HISTORY_ERASE);let Vn=ee;const ne=class ne extends C{constructor(t=0,e){super(ne.opcode,t,e)}static fromPayload(t){let e=0;return t.length>=3&&(e=t[0]<<16|t[1]<<8|t[2]),new ne(e,t)}};o(ne,"opcode",r.POWER_ON);let Mn=ne;const se=class se extends C{constructor(t=0,e=0,s){super(se.opcode,t,s),this.reason=e}static fromPayload(t){let e=0,s=0;return t.length>=3&&(e=t[0]<<16|t[1]<<8|t[2]),t.length>3&&(s=t[3]),new se(e,s,t)}};o(se,"opcode",r.POWER_OFF);let Wn=se;const re=class re extends C{constructor(t=0,e){super(re.opcode,t,e)}static fromPayload(t){let e=0;return t.length>=3&&(e=t[0]<<16|t[1]<<8|t[2]),new re(e,t)}};o(re,"opcode",r.BLOCK_RESET);let zn=re;const ie=class ie extends C{constructor(t=0,e){super(ie.opcode,t,e)}static fromPayload(t){let e=0;return t.length>=3&&(e=t[0]<<16|t[1]<<8|t[2]),new ie(e,t)}};o(ie,"opcode",r.BLE_REBOOT);let $n=ie;const oe=class oe extends C{constructor(t=0,e=new Uint8Array(0),s){super(oe.opcode,t,s),this.data=e}static fromPayload(t){let e=0,s=new Uint8Array(0);return t.length>=3&&(e=t[0]<<16|t[1]<<8|t[2]),t.length>3&&(s=t.slice(3)),new oe(e,s,t)}};o(oe,"opcode",r.LOG_EVENT_SCALE_MEASURE);let Hn=oe;const ce=class ce extends C{constructor(t=0,e){super(ce.opcode,t,e)}static fromPayload(t){let e=0;return t.length>=3&&(e=t[0]<<16|t[1]<<8|t[2]),new ce(e,t)}};o(ce,"opcode",r.LOG_EVENT_KEY_OPENING);let Xn=ce;const ae=class ae extends C{constructor(t=0,e=0,s){super(ae.opcode,t,s),this.errorCode=e}static fromPayload(t){let e=0,s=0;t.length>=3&&(e=t[0]<<16|t[1]<<8|t[2]);const i=3;return t.length>i&&(s=t[i]),new ae(e,s,t)}};o(ae,"opcode",r.LOG_EVENT_ERROR);let jn=ae;const Ee=class Ee extends C{constructor(t=0,e=0,s="",i){super(Ee.opcode,t,i),this.tagType=e,this.uid=s}static fromPayload(t){let e=0,s=0,i="";t.length>=3&&(e=t[0]<<16|t[1]<<8|t[2]);let c=3;if(t.length>c&&(s=t[c],c++),t.length>c){const a=t[c];c++,t.length>=c+a&&(i=p(t.slice(c,c+a)))}return new Ee(e,s,i,t)}};o(Ee,"opcode",r.LOG_EVENT_NFC_OPENING);let Qn=Ee;const le=class le extends C{constructor(t=0,e=new Uint8Array(0),s){super(le.opcode,t,s),this.data=e}static fromPayload(t){let e=0,s=new Uint8Array(0);return t.length>=3&&(e=t[0]<<16|t[1]<<8|t[2]),t.length>3&&(s=t.slice(3)),new le(e,s,t)}};o(le,"opcode",r.LOG_EVENT_NFC_REGISTERING);let qn=le;const Is=[Se,Ne,de,Ce,we,Ie,fe,ge,De,ye,Le,me,Ue,Fe,Ge,ve,pe,xe,Je,Ye,be,Pe,Ke,Te,he,Ve,Ze,Me,We,ze,$e,Be,He,ke,tn,en,nn,sn,rn,on,cn,an,En,ln,_n,un,Tn,hn,On,Rn,An,Sn,Nn,dn,Cn,wn,In,fn,gn,Dn,yn,Ln,mn,Un,Fn,Gn,vn,pn,xn,Yn,bn,Pn,Kn,Vn,Mn,Wn,zn,$n,Hn,Xn,jn,Qn,qn];class cs{static createFromPayload(t,e){if(t.length<3)return;const s=t[0],i=t[1];if(t.length<i+3)return;const c=t.subarray(2,2+i),a=t[i+2],_=os(t.subarray(0,i+2));if(a!==_){e&&e("warn","checksum_error",{opcode:s,expected:_,received:a});return}return this.fromResponse(s,c)}static getConstructor(t){return this.registry.get(t)}static fromResponse(t,e){const s=this.getConstructor(t);if(s)return s.fromPayload(e)}static createRegeneratePackets(t,e){const s=typeof e=="string"?G(e):e;if(s.length!==32)throw new Error("Master Key must be 32 bytes");return[new Te(t,s.slice(0,16)),new he(t,s.slice(16,32))]}}o(cs,"registry",new Map(Is.map(t=>[t.opcode,t])));async function fs(n){const t=await n.read(L.BATTERY_LEVEL).catch(()=>{});return Ds(t)}async function gs(n){const t=await n.read(L.CUSTOM_BATTERY).catch(()=>{});return ys(t)}function Ds(n){const t=n==null?void 0:n[0];return t!==void 0&&t!==x?t:void 0}function ys(n){if(!n||n.length===0||Array.from(n).every(s=>s===x))return;const t=n[n.length-1],e=t!==x?t-25:void 0;if(n.length===6)return{format:"measures-first-min-mean-max-last",level:n[2],temperature:e,details:{first:n[0],min:n[1],mean:n[2],max:n[3],last:n[4]}};if(n.length===4)return{format:"measures-t1-t5-t10",level:n[0],temperature:e,details:{t1:n[0],t5:n[1]!==x?n[1]:void 0,t10:n[2]!==x?n[2]:void 0}}}class rs{constructor(t){o(this,"transport");o(this,"logger");o(this,"responseHandlers",[]);o(this,"listeners",[]);o(this,"commandQueue",Promise.resolve());if(t!=null&&t.transport)this.transport=t.transport;else{if(!(t!=null&&t.device)&&(typeof navigator>"u"||!navigator.bluetooth))throw new O(h.WEB_BLUETOOTH_NOT_SUPPORTED,"No transport provided and Web Bluetooth is not supported.");this.transport=new Cs(t==null?void 0:t.device)}t!=null&&t.logger&&(this.logger=t.logger)}log(t,e,s){this.logger&&this.logger(t,e,s)}async connect(){await this.transport.connect(),await this.transport.subscribe(t=>this.handleNotification(t))}async disconnect(){await this.transport.disconnect()}async getBatteryLevel(){return fs(this.transport)}async getBatteryStats(){return gs(this.transport)}async readCharacteristic(t){return this.transport.read(t)}async send(t){const e=this.commandQueue.then(async()=>{const s=t.encode();this.log("debug","send",{opcode:t.opcode,length:s.length}),await this.transport.write(s)});return this.commandQueue=e.catch(s=>{this.log("error","error",{opcode:t.opcode,error:s})}),e}onPacket(t){return this.listeners.push(t),()=>{this.listeners=this.listeners.filter(e=>e!==t)}}async fetchHistory(t=2e3){const e=[];return new Promise((s,i)=>{let c;const a=()=>{c&&clearTimeout(c),c=setTimeout(()=>{_(),i(new O(h.TIMEOUT,"Timeout during history transfer"))},t)},_=this.onPacket(A=>{A instanceof C?(e.push(A),a()):A.opcode===r.LOG_END_HISTORY&&(c&&clearTimeout(c),_(),s(e))});a(),this.send(new de).catch(A=>{c&&clearTimeout(c),_(),i(A)})})}handleNotification(t){try{const e=cs.createFromPayload(t,(i,c,a)=>this.log(i,c,a));if(!e)return;this.log("debug","receive",{opcode:e.opcode}),this.listeners.forEach(i=>{try{i(e)}catch(c){this.log("error","listener_error",{opcode:e.opcode,error:c})}});const s=this.responseHandlers.findIndex(i=>i.opcodes.includes(e.opcode));if(s!==-1){const i=this.responseHandlers[s];this.responseHandlers.splice(s,1),i.resolve(e)}}catch(e){this.log("error","error",{error:e})}}waitForPacket(t,e=5e3){return this.waitForOneOf([t],e)}waitForOneOf(t,e=5e3){return new Promise((s,i)=>{const c=setTimeout(()=>{const a=this.responseHandlers.findIndex(_=>_.opcodes.length===t.length&&_.opcodes.every((A,I)=>A===t[I]));a!==-1&&this.responseHandlers.splice(a,1),i(new O(h.TIMEOUT,`Timeout waiting for opcodes ${t.map(_=>"0x"+_.toString(16)).join(", ")}`))},e);this.responseHandlers.push({opcodes:t,resolve:a=>{clearTimeout(c),s(a)}})})}}var Oe,v;class Ls{constructor(t){o(this,"client");o(this,"_hardwareInfo",null);je(this,Oe,null);je(this,v,null);t instanceof rs?this.client=t:this.client=new rs(t)}setCredentials(t){let e;if(typeof t=="string"?e=t.replace(/[^0-9A-Fa-f]/g,"").toUpperCase():e=p(t),e.length!==64)throw new O(h.INVALID_PARAMETER,`Master Key must be 32 bytes (64 hex chars), got ${e.length} hex chars`);Qe(this,Oe,e),Qe(this,v,e.slice(-8))}getConfigKeyOrThrow(){if(!Re(this,v))throw new O(h.INVALID_PARAMETER,"Credentials not set. Call setCredentials() first.");return Re(this,v)}async connect(){await this.client.connect(),await this.refreshVersions()}async disconnect(){await this.client.disconnect()}get hardwareInfo(){return this._hardwareInfo}get masterKey(){return Re(this,Oe)}async refreshVersions(){const t=new TextDecoder("utf-8"),e=await this.client.readCharacteristic(L.SOFTWARE_REVISION),s=t.decode(e).replace(/\0/g,"").trim(),i=await this.client.readCharacteristic(L.FIRMWARE_REVISION),c=t.decode(i).replace(/\0/g,"").trim();this._hardwareInfo=this.deriveHardwareInfo(c,s)}deriveHardwareInfo(t,e){let s="Unknown",i="Unknown";return t.includes("10/125")?(s="4.0",i="nRF52833"):t.includes("10/cd")&&(s="3.0",i="nRF52811"),{firmwareRevision:t,softwareRevision:e,hardwareVersion:s,chipset:i}}compareSemVer(t,e){const s=t.split(".").map(Number),i=e.split(".").map(Number),c=Math.max(s.length,i.length);for(let a=0;a<c;a++){const _=s[a]||0,A=i[a]||0;if(_>A)return 1;if(_<A)return-1}return 0}checkRequirements(t){if(!this._hardwareInfo)throw new O(h.UNKNOWN_ERROR,"Hardware info not available. Not connected?",{requirements:t});if(t.minHw&&this._hardwareInfo.hardwareVersion!==t.minHw)throw new O(h.UNSUPPORTED_FEATURE,`${t.featureName} requires Hardware Version ${t.minHw} (detected ${this._hardwareInfo.hardwareVersion})`,{required:t,actual:this._hardwareInfo});if(t.minSw&&this.compareSemVer(this._hardwareInfo.softwareRevision,t.minSw)<0)throw new O(h.UNSUPPORTED_FEATURE,`${t.featureName} requires Software Version >= ${t.minSw} (detected ${this._hardwareInfo.softwareRevision})`,{required:t,actual:this._hardwareInfo})}async scanNFCTags(t=1e4){const e=this.getConfigKeyOrThrow();this.checkRequirements({minHw:"4.0",minSw:"4.3.3",featureName:"NFC Scan"}),await this.client.send(new be(e));const s=await this.client.waitForOneOf([r.NOTIFY_NFC_TAG_FOUND,r.ERROR_NFC_SCAN_TIMEOUT,r.ERROR_NFC_TAG_ALREADY_EXISTS_SCAN],t);if(s.opcode===r.NOTIFY_NFC_TAG_FOUND){const i=s;return{tagId:i.uid,register:()=>this.registerNfcTag(i.uid)}}else{if(s.opcode===r.ERROR_NFC_SCAN_TIMEOUT)throw new O(h.TIMEOUT,"NFC Scan timed out");if(s.opcode===r.ERROR_NFC_TAG_ALREADY_EXISTS_SCAN)throw new O(h.ALREADY_EXISTS,"NFC Tag already exists")}throw new O(h.UNKNOWN_ERROR,`Unexpected packet during scan: ${s.opcode}`)}async registerNfcTag(t){const e=this.getConfigKeyOrThrow();return this.checkRequirements({minHw:"4.0",minSw:"4.3.3",featureName:"NFC Register"}),await this.client.send(new Pe(e,t)),(await this.client.waitForOneOf([r.NOTIFY_NFC_TAG_REGISTERED,r.NOTIFY_NFC_TAG_REGISTERED_ERROR_ALREADY_EXISTS])).opcode===r.NOTIFY_NFC_TAG_REGISTERED}async unregisterNfcTag(t){const e=this.getConfigKeyOrThrow();return this.checkRequirements({minHw:"4.0",minSw:"4.3.3",featureName:"NFC Unregister"}),await this.client.send(new Ke(e,t)),await this.client.waitForPacket(r.NOTIFY_NFC_TAG_UNREGISTERED),!0}async openDoor(t){return await this.client.send(new Se(t)),(await this.client.waitForOneOf([r.VALID_OPEN_CODE,r.INVALID_OPEN_CODE])).opcode===r.VALID_OPEN_CODE}async getDoorStatus(){return await this.client.send(new Ne),(await this.client.waitForOneOf([r.ANSWER_DOOR_STATUS,r.NOTIFY_DOOR_STATUS])).isOpen}async getLogsCount(){return await this.client.send(new we),(await this.client.waitForPacket(r.NOTIFY_LOGS_COUNT)).count}async countCodes(){await this.client.send(new xe);const t=await this.client.waitForPacket(r.NOTIFY_CODES_COUNT);return{masterCount:t.masterCount,otherCount:t.otherCount}}async testBattery(){await this.client.send(new Ie)}async reboot(){await this.client.send(new Ce)}async fetchHistory(t){return this.client.fetchHistory(t)}async createMasterCode(t,e){const s=this.getConfigKeyOrThrow();return await this.client.send(new Ge(s,t,e)),(await this.client.waitForOneOf([r.CODE_OPERATION_SUCCESS,r.CODE_OPERATION_ERROR])).opcode===r.CODE_OPERATION_SUCCESS}async createSingleUseCode(t){const e=this.getConfigKeyOrThrow();return await this.client.send(new ve(e,t)),(await this.client.waitForOneOf([r.CODE_OPERATION_SUCCESS,r.CODE_OPERATION_ERROR])).opcode===r.CODE_OPERATION_SUCCESS}async createMultiUseCode(t){const e=this.getConfigKeyOrThrow();return await this.client.send(new pe(e,t)),(await this.client.waitForOneOf([r.CODE_OPERATION_SUCCESS,r.CODE_OPERATION_ERROR])).opcode===r.CODE_OPERATION_SUCCESS}async deleteMasterCode(t){const e=this.getConfigKeyOrThrow();return await this.client.send(new ye(e,t)),(await this.client.waitForOneOf([r.CODE_OPERATION_SUCCESS,r.CODE_OPERATION_ERROR])).opcode===r.CODE_OPERATION_SUCCESS}async deleteSingleUseCode(t){const e=this.getConfigKeyOrThrow();return await this.client.send(new Le(e,t)),(await this.client.waitForOneOf([r.CODE_OPERATION_SUCCESS,r.CODE_OPERATION_ERROR])).opcode===r.CODE_OPERATION_SUCCESS}async deleteMultiUseCode(t){const e=this.getConfigKeyOrThrow();return await this.client.send(new me(e,t)),(await this.client.waitForOneOf([r.CODE_OPERATION_SUCCESS,r.CODE_OPERATION_ERROR])).opcode===r.CODE_OPERATION_SUCCESS}async reactivateCode(t){const e=this.getConfigKeyOrThrow();return await this.client.send(new Ue(e,t)),(await this.client.waitForOneOf([r.CODE_OPERATION_SUCCESS,r.CODE_OPERATION_ERROR])).opcode===r.CODE_OPERATION_SUCCESS}async editMasterCode(t,e){const s=this.getConfigKeyOrThrow();return await this.client.send(new fe(s,t,e)),(await this.client.waitForOneOf([r.CODE_OPERATION_SUCCESS,r.CODE_OPERATION_ERROR])).opcode===r.CODE_OPERATION_SUCCESS}async setConfiguration(t){const e=this.getConfigKeyOrThrow();return await this.client.send(new Ye(e,t.type,t.value)),(await this.client.waitForOneOf([r.NOTIFY_SET_CONFIGURATION_SUCCESS,r.CODE_OPERATION_ERROR])).opcode===r.NOTIFY_SET_CONFIGURATION_SUCCESS}async convertCodeType(t,e){const s=this.getConfigKeyOrThrow();return e===is.Multi?await this.client.send(new ge(s,t)):await this.client.send(new De(s,t)),(await this.client.waitForOneOf([r.CODE_OPERATION_SUCCESS,r.CODE_OPERATION_ERROR])).opcode===r.CODE_OPERATION_SUCCESS}async initialize(t,e){let s;if(typeof t=="string"){const i=t.replace(/[^0-9A-Fa-f]/g,"");if(i.length!==64)throw new O(h.INVALID_PARAMETER,`Seed string must be 32 bytes (64 hex chars), got ${i.length}`);s=G(i)}else s=t;if(s.length!==32)throw new O(h.INVALID_PARAMETER,`Seed bytes must be 32 bytes, got ${s.length}`);return new Promise((i,c)=>{let a;const _=A=>{A.opcode===r.NOTIFY_CODE_GENERATION_PROGRESS?e&&e(A.progress):A.opcode===r.NOTIFY_CODE_GENERATION_SUCCESS?(a&&a(),i(!0)):A.opcode===r.NOTIFY_CODE_GENERATION_ERROR&&(a&&a(),i(!1))};a=this.client.onPacket(_),this.client.send(new Fe(s)).catch(A=>{a&&a(),c(A)})})}async regenerateMasterKey(t,e){const s=this.getConfigKeyOrThrow();let i;if(typeof t=="string"){const _=t.replace(/[^0-9A-Fa-f]/g,"");if(_.length!==64)throw new O(h.INVALID_PARAMETER,`Master Key string must be 32 bytes (64 hex chars), got ${_.length}`);i=G(_)}else i=t;if(i.length!==32)throw new O(h.INVALID_PARAMETER,`Master Key bytes must be 32 bytes, got ${i.length}`);const c=i.slice(0,16),a=i.slice(16,32);return new Promise((_,A)=>{let I;const U=N=>{N.opcode===r.NOTIFY_CODE_GENERATION_PROGRESS?e&&e(N.progress):N.opcode===r.NOTIFY_CODE_GENERATION_SUCCESS?(I&&I(),_(!0)):N.opcode===r.NOTIFY_CODE_GENERATION_ERROR&&(I&&I(),_(!1))};I=this.client.onPacket(U),this.client.send(new Te(s,c)).then(()=>this.client.send(new he(s,a))).catch(N=>{I&&I(),A(N)})})}async bondScale(){return await this.client.send(new Ve),(await this.client.waitForOneOf([r.NOTIFY_SCALE_BONDING_SUCCESS,r.NOTIFY_SCALE_BONDING_ERROR])).opcode===r.NOTIFY_SCALE_BONDING_SUCCESS}async getScaleWeight(){return await this.client.send(new $e),(await this.client.waitForPacket(r.NOTIFY_SCALE_MEASURE_WEIGHT)).weight}async tareScale(t){return t?(await this.client.send(new We),await this.client.waitForPacket(r.NOTIFY_SCALE_TARE_EMPTY_OK)):(await this.client.send(new ze),await this.client.waitForPacket(r.NOTIFY_SCALE_TARE_LOADED_OK)),!0}async forgetScale(){return await this.client.send(new Me),await this.client.waitForPacket(r.NOTIFY_SCALE_BONDING_FORGET_SUCCESS),!0}async getScaleRawSensors(){return await this.client.send(new He),(await this.client.waitForPacket(r.NOTIFY_SCALE_RAW_SENSORS)).data}}Oe=new WeakMap,v=new WeakMap;const ms={class:"boks-demo"},Us={class:"card"},Fs={class:"row"},Gs=["disabled"],vs={key:0,class:"status success"},ps={key:1,class:"status"},xs={class:"card"},Ys={key:0,class:"key-display"},bs={class:"key-box"},Ps={key:1,class:"empty-state"},Ks={class:"actions"},Vs={class:"history-section"},Ms={key:0,class:"history-list"},Ws={class:"date"},zs={class:"mini-key"},$s=["onClick"],Hs={class:"card"},Xs=["disabled"],js={key:0,class:"progress-bar"},Qs={class:"logs"},qs={class:"log-container"},Js={class:"time"},Zs={__name:"InitializationDemo",setup(n){const t=typeof window<"u",e=F(""),s=F([]),i=F(!1),c=F(""),a=F([]),_=F(!1),A=F(0),I=F(!1);let U=null;Rs(()=>{if(t){const S=localStorage.getItem("boks_master_key");S&&(e.value=S,N("Loaded existing Master Key from storage.","success"));const E=localStorage.getItem("boks_key_history");if(E)try{s.value=JSON.parse(E)}catch(f){console.error("Failed to parse history",f)}}}),kn(e,S=>{t&&S&&localStorage.setItem("boks_master_key",S)}),kn(s,S=>{t&&localStorage.setItem("boks_key_history",JSON.stringify(S))},{deep:!0});function N(S,E="info"){a.value.push({time:new Date().toLocaleTimeString(),msg:S,type:E})}async function Jn(){var S;if(t)try{N("Requesting Bluetooth device..."),U=new Ls,N("Connecting..."),await U.connect(),i.value=!0,c.value=(S=U.hardwareInfo)!=null&&S.hardwareVersion?`Boks (${U.hardwareInfo.hardwareVersion})`:"Boks Device",N("Connected successfully!","success")}catch(E){N(`Connection failed: ${E.message}`,"error"),console.error(E)}}function as(){if(e.value&&!confirm("A Master Key already exists! Are you sure you want to generate a new one? The old one will be moved to history but this is risky if you have already initialized a device with it."))return;const S=new Uint8Array(32);window.crypto.getRandomValues(S);const E=Array.from(S).map(f=>f.toString(16).padStart(2,"0")).join("").toUpperCase();e.value=E,s.value.unshift({key:E,date:new Date().toISOString()}),N("New Master Key generated and saved.","success")}async function Es(){if(!(!U||!i.value)){if(!e.value){alert("No Master Key available!");return}if(confirm("CRITICAL WARNING: This will initialize the connected Boks device with the displayed Master Key. This operation cannot be undone easily. Ensure you have backed up this key. Continue?")){_.value=!0,A.value=0,N("Starting initialization...","warning");try{await U.initialize(e.value,E=>{A.value=E,N(`Initialization progress: ${E}%`)})?(N("Initialization complete! Device is now paired with this Master Key.","success"),alert("Success! Device Initialized.")):N("Initialization failed (device reported error).","error")}catch(S){N(`Initialization error: ${S.message}`,"error")}finally{_.value=!1}}}}function ls(S){navigator.clipboard.writeText(S),N("Copied to clipboard","success")}function _s(){confirm("DANGER: This will delete your Master Key from browser storage. If you lose this key, you may lose access to your device. Are you sure?")&&(localStorage.removeItem("boks_master_key"),e.value="",N("Storage cleared.","warning"))}function us(S){confirm("Restore this key from history as the active Master Key?")&&(e.value=S,N("Key restored from history.","success"))}return(S,E)=>(g(),D("div",ms,[T("div",Us,[E[2]||(E[2]=T("h3",null,"1. Connection",-1)),T("div",Fs,[T("button",{onClick:Jn,disabled:i.value,class:"primary-btn"},y(i.value?"Connected":"Scan & Connect"),9,Gs),i.value?(g(),D("span",vs,"Connected to "+y(c.value),1)):(g(),D("span",ps,"Not connected"))])]),T("div",xs,[E[6]||(E[6]=T("h3",null,"2. Master Key Management",-1)),e.value?(g(),D("div",Ys,[E[3]||(E[3]=T("p",{class:"label"},"Active Master Key (Saved in Storage)",-1)),T("div",bs,[T("code",null,y(e.value),1),T("button",{onClick:E[0]||(E[0]=f=>ls(e.value)),class:"icon-btn",title:"Copy"},"ðŸ“‹")]),E[4]||(E[4]=T("p",{class:"warning-text"},"âš ï¸ Do not lose this key. It is required to control your device.",-1))])):(g(),D("div",Ps,[...E[5]||(E[5]=[T("p",null,"No Master Key found. Generate one to proceed.",-1)])])),T("div",Ks,[T("button",{onClick:as,class:ts(["action-btn",{"secondary-btn":e.value,"primary-btn":!e.value}])},y(e.value?"Regenerate Key (Risky)":"Generate New Master Key"),3),e.value?(g(),D("button",{key:0,onClick:_s,class:"danger-btn text-only"}," Clear Storage ")):qe("",!0)]),T("div",Vs,[T("button",{onClick:E[1]||(E[1]=f=>I.value=!I.value),class:"text-btn"},y(I.value?"Hide History":"Show Key History")+" ("+y(s.value.length)+") ",1),I.value&&s.value.length>0?(g(),D("div",Ms,[(g(!0),D(es,null,ns(s.value,(f,Xe)=>(g(),D("div",{key:Xe,class:"history-item"},[T("span",Ws,y(new Date(f.date).toLocaleString()),1),T("code",zs,y(f.key.substring(0,8))+"...",1),T("button",{onClick:tr=>us(f.key),class:"small-btn"},"Restore",8,$s)]))),128))])):qe("",!0)])]),T("div",Hs,[E[7]||(E[7]=T("h3",null,"3. Device Initialization",-1)),E[8]||(E[8]=T("p",null,"Initialize the connected device with the Active Master Key.",-1)),T("button",{onClick:Es,disabled:!i.value||!e.value||_.value,class:"danger-btn big-btn"},y(_.value?"Initializing...":"Initialize Device"),9,Xs),_.value?(g(),D("div",js,[T("div",{class:"fill",style:As({width:A.value+"%"})},null,4)])):qe("",!0)]),T("div",Qs,[E[9]||(E[9]=T("h4",null,"Logs",-1)),T("div",qs,[(g(!0),D(es,null,ns(a.value,(f,Xe)=>(g(),D("div",{key:Xe,class:ts(["log-entry",f.type])},[T("span",Js,"["+y(f.time)+"]",1),Ss(" "+y(f.msg),1)],2))),128))])])]))}},Bs=Os(Zs,[["__scopeId","data-v-cf9ba4e9"]]),sr=JSON.parse('{"title":"Initialization Demo","description":"","frontmatter":{},"headers":[],"relativePath":"examples/initialization.md","filePath":"examples/initialization.md"}'),ks={name:"examples/initialization.md"},rr=Object.assign(ks,{setup(n){return(t,e)=>(g(),D("div",null,[e[0]||(e[0]=ss('<h1 id="initialization-demo" tabindex="-1">Initialization Demo <a class="header-anchor" href="#initialization-demo" aria-label="Permalink to &quot;Initialization Demo&quot;">â€‹</a></h1><p>This interactive tool allows you to safely generate a <strong>Master Key</strong> and initialize a Boks device.</p><div class="danger custom-block"><p class="custom-block-title">CRITICAL WARNING</p><p><strong>This operation is irreversible without the Master Key.</strong> The Master Key generated here is <strong>stored in your browser&#39;s LocalStorage</strong>. If you clear your browser data or lose this key, you will permanently lose administrative access to your device. <strong>Always back up your key immediately after generation.</strong></p></div>',3)),Ns(Bs),e[1]||(e[1]=ss('<h2 id="how-to-use" tabindex="-1">How to Use <a class="header-anchor" href="#how-to-use" aria-label="Permalink to &quot;How to Use&quot;">â€‹</a></h2><ol><li><strong>Connect</strong>: Click &quot;Scan &amp; Connect&quot; and select your Boks device.</li><li><strong>Generate Key</strong>: If you don&#39;t have a key, generate one. It will be saved automatically.</li><li><strong>Initialize</strong>: Once connected and a key is active, click &quot;Initialize Device&quot;.</li></ol><div class="tip custom-block"><p class="custom-block-title">Note</p><p>This tool uses the Web Bluetooth API and requires a compatible browser (Chrome, Edge, Opera) and Bluetooth hardware.</p></div>',3))]))}});export{sr as __pageData,rr as default};
