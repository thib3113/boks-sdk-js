import{_ as e,o,c as a,a1 as r}from"./chunks/framework.COCkTuSe.js";const m=JSON.parse('{"title":"BLE Protocol & Workflows","description":"","frontmatter":{},"headers":[],"relativePath":"guide/protocol.md","filePath":"guide/protocol.md"}'),d={name:"guide/protocol.md"};function s(i,t,n,c,l,h){return o(),a("div",null,[...t[0]||(t[0]=[r('<h1 id="ble-protocol-workflows" tabindex="-1">BLE Protocol &amp; Workflows <a class="header-anchor" href="#ble-protocol-workflows" aria-label="Permalink to &quot;BLE Protocol &amp; Workflows&quot;">​</a></h1><p>The Boks SDK communicates with the hardware via Bluetooth Low Energy (BLE) using a proprietary GATT service. Communication is asynchronous and based on an opcode-driven request/response model.</p><h2 id="gatt-services-characteristics" tabindex="-1">GATT Services &amp; Characteristics <a class="header-anchor" href="#gatt-services-characteristics" aria-label="Permalink to &quot;GATT Services &amp; Characteristics&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Service</th><th>UUID</th><th>Usage</th></tr></thead><tbody><tr><td><strong>Boks Service</strong></td><td><code>a7630001-f491-4f21-95ea-846ba586e361</code></td><td>Main communication service</td></tr><tr><td><strong>Device Info</strong></td><td><code>0000180a-0000-1000-8000-00805f9b34fb</code></td><td>Versioning and hardware info</td></tr><tr><td><strong>Battery Service</strong></td><td><code>0000180f-0000-1000-8000-00805f9b34fb</code></td><td>Standard battery level</td></tr></tbody></table><h3 id="characteristics-boks-service" tabindex="-1">Characteristics (Boks Service) <a class="header-anchor" href="#characteristics-boks-service" aria-label="Permalink to &quot;Characteristics (Boks Service)&quot;">​</a></h3><ul><li><strong>Write</strong> (<code>a7630002-...</code>): Used to send commands (<strong>Downlink</strong>).</li><li><strong>Notify</strong> (<code>a7630003-...</code>): Used by the device to send status updates and responses (<strong>Uplink</strong>).</li></ul><hr><h2 id="packet-structure" tabindex="-1">Packet Structure <a class="header-anchor" href="#packet-structure" aria-label="Permalink to &quot;Packet Structure&quot;">​</a></h2><p>All packets follow a consistent binary format:</p><p><code>[Opcode (1 byte)] [Length (1 byte)] [Payload (N bytes)] [Checksum (1 byte)]</code></p><ul><li><strong>Opcode</strong>: Identifies the command or notification type.</li><li><strong>Length</strong>: Number of bytes in the payload.</li><li><strong>Payload</strong>: The actual data (arguments or results).</li><li><strong>Checksum</strong>: 8-bit sum of all previous bytes (<code>sum &amp; 0xFF</code>).</li></ul><hr><h2 id="operational-workflows" tabindex="-1">Operational Workflows <a class="header-anchor" href="#operational-workflows" aria-label="Permalink to &quot;Operational Workflows&quot;">​</a></h2><h3 id="_1-code-management" tabindex="-1">1. Code Management <a class="header-anchor" href="#_1-code-management" aria-label="Permalink to &quot;1. Code Management&quot;">​</a></h3><p>The device handles three distinct types of access codes:</p><ul><li><strong>Master Codes</strong>: Permanent PINs stored in 5 dedicated slots (0-4).</li><li><strong>Single-Use Codes</strong>: Temporary PINs that expire immediately after one successful opening.</li><li><strong>Multi-Use Codes</strong>: Reusable temporary PINs. <em>Note: Generation of these codes is disabled in firmware versions &gt; 4.3.3.</em></li></ul><p><strong>Authentication</strong>: Most code operations (Create, Edit, Delete) require a <strong>ConfigKey</strong> (8 bytes) at the beginning of the payload to authorize the change.</p><h3 id="_2-burst-history-transfer-the-burst" tabindex="-1">2. Burst History Transfer (The &quot;Burst&quot;) <a class="header-anchor" href="#_2-burst-history-transfer-the-burst" aria-label="Permalink to &quot;2. Burst History Transfer (The &quot;Burst&quot;)&quot;">​</a></h3><p>When history is requested (<code>0x03 REQUEST_LOGS</code>), the device enters a high-speed notification mode:</p><ol><li>The client sends <code>0x03</code>.</li><li>The device sends a sequence of notification packets, one for each recorded event.</li><li>Each event payload starts with a <strong>3-byte Age</strong> (seconds since the event occurred, Big Endian).</li><li>The sequence <strong>always</strong> ends with a <code>0x92 END_HISTORY</code> packet.</li></ol><h3 id="_3-nfc-tag-workflow" tabindex="-1">3. NFC Tag Workflow <a class="header-anchor" href="#_3-nfc-tag-workflow" aria-label="Permalink to &quot;3. NFC Tag Workflow&quot;">​</a></h3><p>Registering an NFC tag is a two-step &quot;Discovery&quot; process:</p><ol><li><strong>Scan</strong>: Send <code>0x17 REGISTER_NFC_TAG_SCAN_START</code>. The device LED usually flashes.</li><li><strong>Detection</strong>: When a tag is presented, the device emits <code>0xC5 NOTIFY_NFC_TAG_FOUND</code> containing the raw UID.</li><li><strong>Registration</strong>: To persist the tag, the client must send <code>0x18 REGISTER_NFC_TAG</code> with the UID and the <strong>ConfigKey</strong>.</li></ol><hr><h2 id="command-registry-common-opcodes" tabindex="-1">Command Registry (Common Opcodes) <a class="header-anchor" href="#command-registry-common-opcodes" aria-label="Permalink to &quot;Command Registry (Common Opcodes)&quot;">​</a></h2><h3 id="control-status" tabindex="-1">Control &amp; Status <a class="header-anchor" href="#control-status" aria-label="Permalink to &quot;Control &amp; Status&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Opcode</th><th>Name</th><th>Payload</th></tr></thead><tbody><tr><td><code>0x01</code></td><td>OPEN_DOOR</td><td><code>[PIN(6)]</code></td></tr><tr><td><code>0x02</code></td><td>ASK_DOOR_STATUS</td><td>(Empty)</td></tr><tr><td><code>0x06</code></td><td>REBOOT</td><td>(Empty)</td></tr><tr><td><code>0x08</code></td><td>TEST_BATTERY</td><td>(Empty)</td></tr></tbody></table><h3 id="administrative-requires-configkey" tabindex="-1">Administrative (Requires ConfigKey) <a class="header-anchor" href="#administrative-requires-configkey" aria-label="Permalink to &quot;Administrative (Requires ConfigKey)&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Opcode</th><th>Name</th><th>Payload</th></tr></thead><tbody><tr><td><code>0x11</code></td><td>CREATE_MASTER_CODE</td><td><code>[Key(8)] [PIN(6)] [Index(1)]</code></td></tr><tr><td><code>0x12</code></td><td>CREATE_SINGLE_USE</td><td><code>[Key(8)] [PIN(6)]</code></td></tr><tr><td><code>0x0D</code></td><td>DELETE_SINGLE_USE</td><td><code>[Key(8)] [PIN(6)]</code></td></tr><tr><td><code>0x16</code></td><td>SET_CONFIGURATION</td><td><code>[Key(8)] [Type(1)] [Value(1)]</code></td></tr></tbody></table><h3 id="notifications-uplink" tabindex="-1">Notifications (Uplink) <a class="header-anchor" href="#notifications-uplink" aria-label="Permalink to &quot;Notifications (Uplink)&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Opcode</th><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><code>0x77</code></td><td>SUCCESS</td><td>Command acknowledged.</td></tr><tr><td><code>0x78</code></td><td>ERROR</td><td>Command failed (usually auth or format).</td></tr><tr><td><code>0x81</code></td><td>VALID_PIN</td><td>The door is opening.</td></tr><tr><td><code>0x82</code></td><td>INVALID_PIN</td><td>Access denied.</td></tr><tr><td><code>0x84</code></td><td>DOOR_STATUS</td><td><code>0x00</code> (Closed) / <code>0x01</code> (Open).</td></tr><tr><td><code>0xC3</code></td><td>CODES_COUNT</td><td><code>[Master(2)] [Others(2)]</code> (Big Endian).</td></tr></tbody></table><hr><h2 id="experimental-features-scale" tabindex="-1">Experimental Features (Scale) <a class="header-anchor" href="#experimental-features-scale" aria-label="Permalink to &quot;Experimental Features (Scale)&quot;">​</a></h2><p>Recent firmware versions support an integrated scale (<code>0x50</code> to <code>0x62</code>). These commands allow bonding a Boks Scale, taring, and retrieving real-time weight measurements.</p>',34)])])}const g=e(d,[["render",s]]);export{m as __pageData,g as default};
